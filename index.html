<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>LSAFERS Auth Demo</title>

    <!-- Supabase JS client -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  </head>

  <body>
    <h1>LSAFERS Auth Demo</h1>

    <div>
      <input id="email" placeholder="email" />
      <input id="password" type="password" placeholder="password" />
      <button onclick="login()">Login</button>
    </div>

    <hr />

    <button onclick="callBackend()">Call Protected Backend</button>

    <pre id="output">Not logged in</pre>

    <script>
      // ðŸ”´ REPLACE THESE TWO VALUES
      const SUPABASE_URL = "https://alrvzkpvzbemizsjeozw.supabase.co";
      const SUPABASE_ANON_KEY = "sb_publishable_5lnKeDUnm1gH4eNFVpgNgg_yDe76fJG";

      const supabase = supabase.createClient(
        SUPABASE_URL,
        SUPABASE_ANON_KEY
      );

      async function login() {
        const email = document.getElementById("email").value;
        const password = document.getElementById("password").value;

        const { data, error } = await supabase.auth.signInWithPassword({
          email,
          password,
        });

        if (error) {
          document.getElementById("output").textContent = error.message;
          return;
        }

        document.getElementById("output").textContent =
          "Logged in as " + data.user.email;
      }

      async function callBackend() {
        const {
          data: { session },
        } = await supabase.auth.getSession();

        if (!session) {
          document.getElementById("output").textContent =
            "Not logged in";
          return;
        }

        const res = await fetch(
          "https://lsafers-backend.onrender.com/protected",
          {
            headers: {
              Authorization: `Bearer ${session.access_token}`,
            },
          }
        );

        const json = await res.json();
        document.getElementById("output").textContent =
          JSON.stringify(json, null, 2);
      }
    </script>
  </body>
</html>